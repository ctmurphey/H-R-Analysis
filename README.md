# H-R-Analysis
An analysis of the Hertzsprung-Russell diagram using a small fraction of the data from the most recent data release from [GAIA](https://gea.esac.esa.int/archive/) in a Jupyter Notebook. This project served as my final project for my Graduate-level Stars class for Fall 2021.

## Libraries
Outside of NumPy, PANDAS and matplotlib (and its toolkit), this program uses [PyMC3](https://pypi.org/project/pymc3/), [PyMC3-ext](https://pypi.org/project/pymc3-ext/) and [Theano](https://pypi.org/project/Theano/) for implementing a Markov-Chain Monte Carlo (MCMC) algorithm. It's best to make sure these are installed in order to run this code.

## Data
**This is not included in the repo as it is too large to store on GitHub, it can be downloaded [here](https://cdn.gea.esac.esa.int/Gaia/gedr3/gaia_source/GaiaSource_786097-786431.csv.gz)**

The .csv file contains the data of thousands of stars taken during the [third GAIA data release](https://cdn.gea.esac.esa.int/Gaia/gedr3/gaia_source/). There are hundreds of more files like these, and I've tried adding a few extras into the mix, but the MCMC scales very poorly as more data is added and takes far to long to run with even two datasets. I also feel the final result is sufficient in it's conclusions.

## Analysis

### Assumptions:
There are a few key assumptions in the calculations that vary in how well they hold true. Most of these assumptions arise from a lack of data or the necessary computational time. I will discuss in the procedure section the implications of these assumptions on the results obtained. The first one in the procedure is that the HR-Diagram doesn't change throughout the data gathered through the entire GAIA survey and that one dataset accurately represents the whole of the data. The second is that the ````phot_g_mean_mag```` column in the data is an accurate representation of the total luminosity. The third is that dust extinction is minimal compared to extinction due to the distance modulus. The last assumption is that the Magnitude-color relation is linear on the H-R diagram.

### Procedure:
The data is first stored into a PANDAS dataframe then sorted out based on noise level and if a relevant value was stored as a NaN. Then the parallax angle measured by the GAIA satellite is converted into a distance. Since the parallax data is stored in units of milliarcseconds(mas), the conversion to parsec is simply d[pc] = 1000/parallax[mas]. Then the galactic coordinates (l,b) of the entries are combined with this distance to get cartesian coodinates to plot in 3D with respect to the sun. The 3D plot shows what small fraction of the full sky this selection of GAIA data covers. The first assumption above means that this one section is a sufficiently accurate representation of stars in the Milky Way.

The next part of the notebook makes an H-R diagram of the stars, plotting their colors (and therefore temperatures) against their magnitude (log scale luminosity)). The GAIA data contains the apparent magnitude (m) in certain bands, of which the most helpful here is the G-band which covers most of the visible spectrum and [all of the other bands used](https://www.cosmos.esa.int/web/gaia/iow_20180316). If the second assumption above doesn't hold, then we do not have enough data to calculate the total luminosity. To convert this into absolute magnitude, we need to calculate the amount of flux decrease caused by distance, known as the distance modulus. The formula for this is mod = -2.5log(d/10pc). After this, to convert the apparent magnitude (m) to absolute magnitude (M, intrinsic to the luminosity), it's just M = m - mod. Here, if the third assumption doesn't hold, the calculated true values will be off by an effectively random amound, but always dimmer than the actual true values. To make the Hertzprung-Russell (H-R) diagram, plot this absolute magnitude vs color (````bp_rp```` column in the data). The non-zero dust extinction causes most of the distributions to scatter out wider than they truly are, getting dimmed by random amounts.

Next the code tries to fit a line to the main sequence (large diagonal cluster) portion of the plot. Plotting the raw data shows that the linear relation assumption isn't the worst thing. Calculating higher orders though would drastically increase the computation time and not improve the fit significantly. First we try the naiive way which is to just perform the MCMC on all of the data, regardless on whether or not it is actually on the main sequence or not. This produces a line that looks very off and most likely wrong. We fix this by introducing a second distribution to capture "outliers", the white dwarfs and red giants. This distribution has zero slope and a very wide standard deviation. Stars close to the MS fit line will stay with that while those further off will be binned with the outliers as the MCMC does it's calculations. The result is a line that fits very will to the MS part of the graph.